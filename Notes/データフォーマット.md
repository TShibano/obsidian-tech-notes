---
title: "データフォーマット"
date: 2026-02-07
tags:
  - DB
  - Cloud
related:
  - "[[Apache Parquet]]"
  - "[[Apache Avro]]"
  - "[[データレイク]]"
  - "[[DuckDB]]"
  - "[[Polars]]"
  - "[[JSON]]"
  - "[[YAML]]"
  - "[[TOML]]"
  - "[[Apache Arrow]]"
  - "[[Apache Hadoop]]"
---

## 概要

データフォーマットとは、データを格納・交換するためのファイル形式の総称である。CSV や JSON のようなテキスト形式から、[[Apache Parquet]] や [[Apache Avro]] のようなバイナリ形式まで多様な種類があり、行指向と列指向という2つの根本的な設計思想によって、適したユースケースが大きく異なる。

## 詳細

### 行指向 vs 列指向

データフォーマットの最も基本的な分類は、データの格納方向による区分である:

| 観点 | 行指向 | 列指向 |
|------|--------|--------|
| **格納方式** | 1レコードの全フィールドを連続して格納 | 同一カラムの全値を連続して格納 |
| **読み取り** | 1行全体の読み取りが高速 | 特定カラムのみの読み取りが高速 |
| **書き込み** | 1行単位の挿入・更新が高速 | バッチ書き込みに適する |
| **圧縮** | 異なる型が混在し、圧縮率は低い | 同一型データが連続し、高い圧縮率 |
| **主な用途** | OLTP（トランザクション処理） | OLAP（分析処理） |
| **代表例** | CSV、[[Apache Avro]]、JSON | [[Apache Parquet]]、ORC、Apache Arrow |

### 主要なデータフォーマット一覧

#### テキスト形式

| フォーマット | 形式 | 特徴 | 主な用途 |
|-------------|------|------|----------|
| **CSV** | 行指向・テキスト | 人間が読める、ツール間の互換性が高い。スキーマなし、型情報なし、圧縮なし | データ交換、小規模データ、Excel 連携 |
| **TSV** | 行指向・テキスト | CSV のタブ区切り版。フィールド内にカンマを含むデータに有利 | CSV と同様 |
| **[[JSON]]** | 行指向・テキスト | 柔軟なネスト構造、スキーマレス。人間が読める。冗長でサイズが大きい | Web API、設定ファイル、ドキュメント DB |
| **JSON Lines（JSONL）** | 行指向・テキスト | 1行1 JSON オブジェクト。ストリーミング処理に適する | ログ、ストリーミングデータ、ML データセット |
| **XML** | 行指向・テキスト | タグベースの構造化データ。スキーマ定義（XSD）が可能。冗長 | エンタープライズ連携、SOAP API |

#### バイナリ形式（行指向）

| フォーマット | 形式 | 特徴 | 主な用途 |
|-------------|------|------|----------|
| **[[Apache Avro]]** | 行指向・バイナリ | スキーマ進化に優れる。スキーマを JSON で定義しデータとともに格納。圧縮効率は中程度 | データストリーミング（Kafka）、ETL 中間フォーマット、スキーマレジストリ |
| **Protocol Buffers** | 行指向・バイナリ | Google 開発。高速なシリアライゼーション。スキーマ定義が必須（.proto ファイル） | gRPC 通信、マイクロサービス間通信 |
| **MessagePack** | 行指向・バイナリ | JSON に似た構造をバイナリで格納。JSON より高速でコンパクト | RPC、キャッシュ、軽量データ交換 |

#### バイナリ形式（列指向）

| フォーマット | 形式 | 特徴 | 主な用途 |
|-------------|------|------|----------|
| **[[Apache Parquet]]** | 列指向・バイナリ | 高い圧縮率（CSV の約1/4）。列の統計情報（min/max）を格納し、クエリ最適化に活用。最も広く使われる分析用フォーマット | データレイク、分析ワークロード、Spark/[[DuckDB]]/[[Polars]] |
| **ORC** | 列指向・バイナリ | Hive 向けに最適化。高い圧縮率。ストライプ単位のインデックス | Hive / Hadoop エコシステム |
| **Apache Arrow IPC** | 列指向・バイナリ | インメモリ列指向フォーマットのディスク表現。ゼロコピーでの読み取りが可能。プロセス間通信に最適化 | プロセス間データ転送、[[Polars]] / [[DuckDB]] のバックエンド |
| **Lance** | 列指向・バイナリ | ベクトルデータ向けに最適化。ランダムアクセスとベクトル検索に対応 | ML / AI、ベクトルデータベース |

### フォーマット選定ガイド

| ユースケース | 推奨フォーマット | 理由 |
|-------------|----------------|------|
| 小規模データの共有・手作業 | CSV | 人間が読める、Excel で開ける |
| Web API のレスポンス | [[JSON]] | 広くサポート、ネスト構造対応 |
| ストリーミングデータ（Kafka 等） | [[Apache Avro]] | スキーマ進化、行指向で高速書き込み |
| データレイクでの分析 | [[Apache Parquet]] | 高い圧縮率、列単位の読み取り |
| Hive / Hadoop 分析 | ORC | Hive に最適化された列指向フォーマット |
| プロセス間データ転送 | Apache Arrow IPC | ゼロコピー、ゼロデシリアライゼーション |
| マイクロサービス間通信 | Protocol Buffers | 高速、型安全、スキーマ定義 |
| ML / ベクトルデータ | Lance | ベクトル検索対応、ランダムアクセス |

### 圧縮とサイズ比較

同一データセット（10MB）を各フォーマットで格納した場合の目安:

| フォーマット | 圧縮アルゴリズム | おおよそのサイズ |
|-------------|----------------|----------------|
| CSV | なし | 10 MB（基準） |
| JSON | なし | 15〜20 MB |
| Avro | Snappy | 6〜7 MB |
| Parquet | Snappy | 2〜3 MB |
| ORC | Zlib | 2〜3 MB |

### 最新動向（2026年）

- **Parquet がデファクトスタンダードに**: データレイクおよびレイクハウスの標準フォーマットとして広く定着
- **Apache Arrow の普及**: [[Polars]]、[[DuckDB]] など新世代ツールが Arrow をインメモリフォーマットとして採用
- **Lance フォーマットの台頭**: AI/ML 向けのベクトルデータフォーマットとして注目を集める
- **CSV の縮小**: 大規模データ処理での CSV 利用は「CSV Hell」と呼ばれ、Parquet への移行が加速

## ポイント

- データフォーマットは行指向（書き込み最適化）と列指向（読み取り・分析最適化）に大別される
- 分析用途では列指向の [[Apache Parquet]] がデファクトスタンダード。CSV と比較して圧縮率が4倍以上
- ストリーミングやスキーマ進化が重要な場面では行指向の [[Apache Avro]] が適する
- Apache Arrow IPC はインメモリ処理のゼロコピー転送に最適化されたフォーマット
- フォーマット選定はユースケース（分析 vs トランザクション vs 通信）に応じて判断する

## 関連項目

- [[Apache Parquet]] - データレイクの標準列指向ファイルフォーマット
- [[Apache Avro]] - スキーマ進化に優れた行指向シリアライゼーション
- [[DuckDB]] - 多様なデータフォーマットを直接 SQL でクエリ可能
- [[Polars]] - Arrow ベースで Parquet / Avro / CSV 等に対応
- [[データレイク]] - データフォーマットが格納される基盤
- [[JSON]] - Web API の標準的なテキストベースのデータ交換フォーマット
- [[YAML]] - 設定ファイル向けのデータシリアライゼーション言語
- [[TOML]] - 設定ファイルに特化したシンプルなフォーマット
- [[Apache Arrow]] - 列指向インメモリデータフォーマット
- [[Apache Hadoop]] - 大規模分散処理フレームワーク。ORC フォーマット等の起源

## 参考

- [Upsolver - Parquet, ORC, and Avro: The File Format Fundamentals of Big Data](https://www.upsolver.com/blog/the-file-format-fundamentals-of-big-data)
- [Adaltas - Comparison of different file formats in Big Data](https://www.adaltas.com/en/2020/07/23/benchmark-study-of-different-file-format/)
- [BryteFlow - How to choose between Parquet, ORC and Avro](https://bryteflow.com/how-to-choose-between-parquet-orc-and-avro/)
- [MotherDuck - A Data Engineer's Guide to Columnar Storage](https://motherduck.com/learn-more/columnar-storage-guide/)
- [Apache Arrow FAQ](https://arrow.apache.org/faq/)
