---
title: "テスト駆動開発"
date: 2026-02-20
tags:
  - DevOps
related:
  - "[[設計]]"
  - "[[要件定義]]"
---

## 概要

テスト駆動開発（TDD: Test-Driven Development）とは、プログラムの各機能について「まずテストコードを書き、そのテストが通る最小限の実装を行い、コードをリファクタリングする」という短いサイクルを繰り返すソフトウェア開発の手法である。Kent Beck が提唱し、アジャイル開発・XP（エクストリームプログラミング）の中核プラクティスの一つとして広まった。

## 詳細

### 基本サイクル：Red → Green → Refactor

TDD の核心は以下の3ステップの繰り返しである：

```
┌─────────────────────────────────┐
│  1. Red（レッド）                │
│     失敗するテストコードを書く    │
│         ↓                       │
│  2. Green（グリーン）            │
│     テストが通る最小限の実装     │
│         ↓                       │
│  3. Refactor（リファクタリング）  │
│     コードを整理・改善           │
│         ↓ (次のサイクルへ)       │
└─────────────────────────────────┘
```

#### Step 1: Red（失敗するテストを書く）

まだ実装していない機能に対するテストコードを書く。この時点ではテストは必ず失敗する（赤）。

- テストを先に書くことで、仕様・設計を明確に考える強制力が生まれる
- 「どう使われるか」から逆算した自然なインターフェース設計につながる

#### Step 2: Green（テストを通す実装をする）

テストが通ることだけを目標に、最小限の実装を行う。品質よりもまずグリーンにすることを優先。

- 最初はベタな実装・ハードコードでも可
- 過度な設計・最適化はこのステップでは不要

#### Step 3: Refactor（コードを整理する）

テストが通った状態を維持したまま、コードの可読性・保守性を向上させる。

- 重複排除（DRY）・命名改善・メソッド分割等
- テストが常にグリーンであることを確認しながら進める

### コード例（Python）

```python
# Step 1: Red（テストを先に書く）
def test_add():
    assert add(2, 3) == 5  # まだ add() は実装していない → テスト失敗

# Step 2: Green（最小限の実装）
def add(a, b):
    return a + b  # テストが通る最小限

# Step 3: Refactor（必要なら整理）
def add(a: int, b: int) -> int:
    """2つの整数の和を返す"""
    return a + b
```

### TDD のメリット

| メリット | 詳細 |
|---------|------|
| **早期の不具合検出** | 機能追加と同時にテストが作られるため、リグレッションを即時検知 |
| **仕様の明確化** | テストを書く行為が「何を実装すべきか」の思考を促す |
| **リファクタリングの安全網** | テストがあるため、コード改善時の安全性が確保される |
| **設計の改善** | テストしやすいコードは自然と疎結合・単一責任になる |
| **ドキュメント代替** | テストコードが「仕様書」の役割を果たす |

### TDD の注意点・デメリット

- **初期コスト**: テストコードを書く分、初期の実装時間が増加する
- **スキルが必要**: テストの書き方・TDD の進め方を習得するまで習熟コストがかかる
- **全箇所に適用しなくてよい**: UI・DB・外部API との結合テストには不向きな場合も
- **短納期案件**: 厳しい締め切り下では逆効果になることもある

### BDD（振る舞い駆動開発）との関係

BDD（Behavior-Driven Development）は TDD を拡張し、自然言語でテストを記述することでビジネス側と開発側の共通言語とする手法。

```
Given（前提条件）: ユーザーがカートに商品を追加した状態で
When（操作）:      決済ボタンをクリックしたとき
Then（期待結果）:  注文確認メールが送信される
```

### 関連する開発手法・テスト種別

| 手法 | 位置づけ |
|------|---------|
| **ユニットテスト** | TDD の基本単位。最小の機能単位（関数・クラス）をテスト |
| **統合テスト** | 複数モジュールの連携をテスト。TDD サイクル外で別途実施 |
| **BDD** | TDD の上位概念。自然言語で仕様を記述 |
| **CI/CD** | TDD で書いたテストを自動実行する基盤 |

## ポイント

- TDD の価値は「テストを書くこと」ではなく「テストを先に書くことで設計を改善すること」にある
- Red → Green → Refactor のサイクルは小さく速く回す（1サイクル5〜15分が目安）
- テストが通る最小限の実装を意識し、過度な最適化・先読み設計はしない（YAGNI）
- 100% の TDD 適用は現実的でない。複雑なビジネスロジックから始め、徐々に範囲を拡大するのが現実的
- テストコードも本番コードと同様に保守・リファクタリングの対象

## 関連項目

- [[設計]]
- [[要件定義]]

## 参考

- [テスト駆動開発（書籍）Kent Beck 著、和田卓人 訳](https://www.amazon.co.jp/dp/4274217884)
- [テスト駆動開発（TDD）とは？目的やメリット・デメリット - SHIFT](https://service.shiftinc.jp/column/4654/)
- [What is Test-Driven Development (TDD)? - IBM](https://www.ibm.com/think/topics/test-driven-development)
- [テスト駆動開発（TDD）とは？実践手順と導入のメリット・課題まで徹底解説 - Autify](https://blog.autify.jp/article/tdd-implementation-benefits-challenges-guide)
