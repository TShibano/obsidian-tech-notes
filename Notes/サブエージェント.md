---
title: "サブエージェント"
date: 2026-02-20
tags:
  - AI
  - Agent
  - Tool
related:
  - "[[Claude Code]]"
  - "[[エージェントスキル]]"
  - "[[MCP]]"
---

## 概要

サブエージェント（Subagent）とは、メインの AI エージェントセッションから独立したコンテキストウィンドウで動作する専門特化型の AI アシスタントである。Claude Code では Task ツールを通じて委任・起動され、固有のシステムプロンプト・ツールアクセス・パーミッションを持ちながらタスクを完了し結果を返す。

## 詳細

### Claude Code のサブエージェント

#### 基本概念

サブエージェントは以下の特性を持つ：

- **独立コンテキスト**: メイン会話の履歴は引き継がない（別セッション）
- **専門化**: 特定タスクに最適化されたシステムプロンプト
- **ツール制限**: 必要最小限のツールアクセスで安全性を確保
- **モデル選択**: Haiku（高速・低コスト）〜 Opus（高能力）を用途別に選択

#### ビルトインサブエージェント

| エージェント | モデル | ツール | 主な用途 |
|------------|--------|--------|---------|
| **Explore** | Haiku | 読み取り専用 | コードベース探索・ファイル検索 |
| **Plan** | 継承 | 読み取り専用 | プランモード時のリサーチ |
| **general-purpose** | 継承 | 全ツール | 複雑・複数ステップのタスク |
| **Bash** | 継承 | Bash | ターミナルコマンドの独立実行 |
| **Claude Code Guide** | Haiku | 検索系 | Claude Code の機能に関する質問 |

#### カスタムサブエージェントの作成

Markdown ファイルに YAML フロントマターでサブエージェントを定義する：

```markdown
---
name: code-reviewer
description: コードのレビューを行う専門エージェント。コード変更後に自動的に呼び出す。
tools: Read, Grep, Glob, Bash
model: sonnet
memory: project
---

あなたはシニアコードレビュアーです。セキュリティ、可読性、パフォーマンスの観点でレビューを行い、
優先度別に問題点を報告してください。
```

#### 格納場所とスコープ

| 場所 | パス | 優先度 |
|------|------|--------|
| CLI フラグ | `--agents` JSON | 最高（セッション限定） |
| プロジェクト | `.claude/agents/` | 高 |
| ユーザー | `~/.claude/agents/` | 中 |
| プラグイン | `<plugin>/agents/` | 低 |

#### フロントマターの主要フィールド

| フィールド | 説明 |
|-----------|------|
| `name` | 一意の識別子（英小文字・ハイフン） |
| `description` | Claude が委任を判断する説明文 |
| `tools` | 使用を許可するツールのリスト |
| `disallowedTools` | 使用を禁止するツールのリスト |
| `model` | 使用モデル（`sonnet`/`opus`/`haiku`/`inherit`） |
| `permissionMode` | パーミッションモード（`default`/`dontAsk`/`bypassPermissions`等） |
| `memory` | 永続メモリのスコープ（`user`/`project`/`local`） |
| `skills` | 起動時にロードするスキルリスト |
| `isolation` | `worktree` で独立した git worktree で実行 |
| `background` | `true` でバックグラウンド実行をデフォルト化 |
| `maxTurns` | 最大ターン数 |

#### 永続メモリ機能

`memory` フィールドを設定するとセッションをまたいで知識を蓄積できる：

- `user`: `~/.claude/agent-memory/<name>/`（全プロジェクト共通）
- `project`: `.claude/agent-memory/<name>/`（プロジェクト固有・バージョン管理可）
- `local`: `.claude/agent-memory-local/<name>/`（プロジェクト固有・バージョン管理除外）

### フォアグラウンド vs バックグラウンド

| 種類 | 動作 | 用途 |
|------|------|------|
| フォアグラウンド | 完了まで待機、パーミッション確認あり | インタラクティブなタスク |
| バックグラウンド | 並行実行、事前にパーミッション確認 | 長時間の独立タスク |

### 他 AI ツールにおけるサブエージェント

| ツール | 実装 | 特徴 |
|--------|------|------|
| Claude Code | Task ツール + `.claude/agents/` | カスタム定義・永続メモリ・スキルプリロード |
| Cursor | 最大8並列エージェント + クラウドバックグラウンドエージェント | 複数エージェントの並列実行 |
| Windsurf | Cascade エージェント | ファイル・ターミナル・クリップボードを監視して予測実行 |
| OpenAI Agent SDK | `Agent` クラス + ハンドオフ機能 | マルチエージェントオーケストレーション |

### エージェントチームとの違い

| 観点 | サブエージェント | エージェントチーム |
|------|----------------|------------------|
| セッション数 | 単一セッション内 | 複数の独立セッション |
| 通信 | メイン→サブの一方向 | セッション間の双方向通信 |
| スケール | コンテキストウィンドウ内 | コンテキスト制限を超えた大規模タスク |

## ポイント

- サブエージェントの `description` はClaude が委任タイミングを判断する最重要要素で「積極的に使う場合は...」など行動トリガーを記述する
- `tools` でツールを制限すると安全性が向上し、例えばコードレビューエージェントには書き込み系ツールを与えない
- Haiku モデルのサブエージェントは高速・低コストで探索タスクに最適
- `isolation: worktree` を使うと独立した git worktree でサブエージェントを実行でき、実験的な変更をメインブランチに影響させない
- サブエージェントはサブエージェントをスポーンできない（ネスト不可）

## 関連項目

- [[Claude Code]]
- [[エージェントスキル]]
- [[MCP]]

## 参考

- [Create custom subagents - Claude Code Docs](https://code.claude.com/docs/en/sub-agents)
- [Claude Code Agent Teams](https://claudefa.st/blog/guide/agents/agent-teams)
- [Awesome Claude Code Subagents](https://github.com/VoltAgent/awesome-claude-code-subagents)
